# coacoa/coacoa.yaml  â€”  v0.1.0-beta  (BMAD-compatible superset)
coa:

  # ---------- PATHS ----------
  paths:
    # Unified Analysis Structure
    analysis_dir:           coacoa/context/analysis/            # Main analysis directory
    analysis_plan:          coacoa/context/analysis/plan.md     # Master analysis plan
    analysis_artifacts:     coacoa/context/analysis/artifacts/  # JSON intelligence files
    analysis_reports:       coacoa/context/analysis/reports/    # Individual task reports
    analysis_consolidated:  coacoa/context/analysis/consolidated/ # Final consolidated outputs
    
    # Legacy Paths (for backward compatibility) - aligned with actual structure
    analysis:        coacoa/context/analysis.md
    module_map:      coacoa/context/intelligence/module_map.json
    dep_graph:       coacoa/context/intelligence/dep_graph.json
    dependencies:    coacoa/context/intelligence/dep_graph.json
    cycles:          coacoa/context/intelligence/dep_graph.json
    complexity:      coacoa/context/intelligence/complexity.json
    hotspots:        coacoa/context/intelligence/hotspots.json
    coverage:        coacoa/context/intelligence/coverage.json
    build_info:      coacoa/context/intelligence/build_info.json
    
    # Standard Paths
    docs_dir:        coacoa/docs/
    adr_dir:         coacoa/docs/adr/                 # Architecture Decision Records

  # ---------- PRD ----------
  prd:
    main:            coacoa/docs/prd.md
    sharded:         true
    shard_dir:       coacoa/docs/prd

  # ---------- TEMPLATES ----------
  templates:
    ui_ux:                    coacoa/templates/ui_ux.md                    # Green- & brown-field reference
    codebase_analysis_master: coacoa/templates/codebase_analysis_master.md # Master analysis template
    analysis_plan_template:   coacoa/templates/analysis_plan_template.md   # Plan generation template
    progress_tracker:         coacoa/templates/progress_tracker.md         # Progress tracking utilities
    model_adaptation:         coacoa/templates/model_adaptation.md         # AI model adaptation protocol
    error_handling:           coacoa/templates/error_handling.md           # Error handling patterns
    prd:                      coacoa/templates/prd.md                      # Product requirements template
    epic:                     coacoa/templates/epic.md                     # Epic template
    story:                    coacoa/templates/story.md                    # Story template
    architecture:             coacoa/templates/architecture.md             # Architecture template
    adr:                      coacoa/templates/adr.md                      # ADR template
    
  # ---------- SCHEMAS ----------
  schemas:
    artifacts:               coacoa/schemas/artifact_schemas.json          # JSON artifact validation schemas

  # ---------- ARCHITECTURE ----------
  arch:
    main:            coacoa/docs/architecture.md
    sharded:         true
    shard_dir:       coacoa/docs/architecture

  # ---------- FILE PREFIXES ----------
  file_prefixes:
    story:           "s_"
    epic:            "e_"
    domain_doc:      "d_"

  # ---------- DATA (shared knowledge) ----------
  data:
    tech_preferences: coacoa/data/tech_preferences.md
    style_guides:     coacoa/data/style_guides/
    pattern_library:  coacoa/data/pattern_library/
    language_rules:   coacoa/data/language_rules.md
    solid_policy:     coacoa/data/solid_policy.md

  # ---------- WORKFLOWS ----------
  workflows:
    greenfield:      coacoa/workflows/default_greenfield.yaml
    brownfield:      coacoa/workflows/default_brownfield.yaml

  # ---------- QUALITY CHECKS ----------
  quality:
    anti_hallucination:       coacoa/quality/anti_hallucination.md
    link_integrity:           coacoa/quality/link_integrity.md
    qa:                       coacoa/quality/qa.md
    arch_integrity:           coacoa/quality/architecture_integrity.md
    build_integrity:          coacoa/quality/build_integrity.md
    code_quality_gate:        coacoa/quality/code_quality_gate.md
    security_gate:            coacoa/quality/security_gate.md
    performance_gate:         coacoa/quality/performance_gate.md
    unified_analysis_validation: coacoa/quality/unified_analysis_validation.md

  # ---------- LIMITS ----------
  limits:
    max_snippet_loc:      120        # LOC injected per story
    max_tokens_context:   12000      # Soft prompt budget
    refactor_batch_size:  200        # LOC per refactor step

  # ---------- UNIFIED ANALYSIS ----------
  analysis:
    # Core Configuration
    enterprise_mode:      true       # Enable enterprise-specific exclusions and features
    unified_workflow:     true       # Use new unified analysis workflow
    auto_mode_detection:  true       # Automatically detect Claude Code vs Cline execution mode
    
    # File Discovery & Processing
    exclude_patterns:     []         # Custom exclusion patterns (overrides defaults)
    token_estimation:     "enhanced" # enhanced | simple | ast_based
    batch_affinity:       "directory" # directory | language | complexity
    max_file_tokens:      6000       # Single file token limit (50% of context)
    complexity_threshold: 15         # Cyclomatic complexity threshold for "complex" files
    
    # Execution Configuration
    parallel_task_limit:  8          # Max parallel tasks for Claude Code mode
    retry_failed_phases:  true       # Retry failed analysis phases
    partial_results:      true       # Allow partial analysis results on failure
    
    # Quality & Validation
    schema_validation:    true       # Validate all artifacts against schemas
    evidence_requirement: true      # Require evidence-based findings only
    cross_validation:     true      # Cross-validate findings between phases
    
    # Output Configuration
    executive_summary:    true       # Generate executive summary
    detailed_reports:     true       # Generate detailed phase reports
    risk_prioritization:  true       # Prioritize findings by risk level
    recommendations:      true       # Generate actionable recommendations
    
    # Incremental Analysis Configuration (NEW)
    incremental_analysis: true       # Enable change-based selective analysis
    change_threshold_full: 20        # Files changed requiring full analysis
    change_threshold_selective: 5    # Files changed for selective analysis
    git_history_months: 12          # Months of git history for team analysis

  # ---------- BRANCHING ----------
  branching:
    brownfield_trigger:   coacoa/context/analysis.md
    auto_create:  true

  # ---------- ORCHESTRATOR ----------
  orchestrator:
    parallel_stories:     3
    retry_failed_tasks:   true

  # ---------- CONTEXT OPTIMIZATION (NEW) ----------
  context:
    relevance_threshold: 5            # Minimum relevance score for inclusion
    incremental_analysis: true        # Enable change-based selective analysis  
    team_knowledge_integration: true  # Include team expertise in analysis
    token_budget_management: true     # Enable token allocation optimization
    recent_change_boost: true         # Boost relevance for recently changed files
    
  # ---------- AI MODEL ADAPTATION (NEW) ----------
  ai_adaptation:
    auto_detect_environment: true       # Automatically detect Claude Code vs Cline
    token_allocation_strategy: "adaptive" # adaptive|conservative|aggressive
    model_specific_formatting: true     # Use model-optimized prompt formats
    fallback_mode: "generic"           # Fallback when detection fails
    
    # Token limits by environment
    token_limits:
      claude_code: 200000
      cline: 128000
      generic: 8000
      
    # Token allocation percentages by environment
    token_allocation:
      claude_code:
        codebase_context: 0.40        # 40%
        analysis_instructions: 0.20   # 20%
        generated_content: 0.30       # 30%
        safety_buffer: 0.10           # 10%
      cline:
        codebase_context: 0.39        # 39%
        analysis_instructions: 0.20   # 20%
        generated_content: 0.30       # 30%
        safety_buffer: 0.11           # 11%
      generic:
        codebase_context: 0.37        # 37%
        analysis_instructions: 0.19   # 19%
        generated_content: 0.31       # 31%
        safety_buffer: 0.13           # 13%

  # ---------- LLM DEFAULTS ----------
  llm:
    default:       claude-sonnet-4.0
    temperature:   0.2
    top_p:         1.0